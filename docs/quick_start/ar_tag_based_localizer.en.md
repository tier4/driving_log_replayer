# ArTagBasedLocalizer Evaluation

## Preparation

1. Copy sample scenario

   ```shell
   mkdir -p ~/driving_log_replayer_data/ar_tag_based_localizer/sample
   cp -r ~/autoware/src/simulator/driving_log_replayer/sample/ar_tag_based_localizer/scenario.yaml ~/driving_log_replayer_data/ar_tag_based_localizer/sample
   ```

2. Download bag file
   Download a rosbag from [Google Drive Link](https://drive.google.com/file/d/1uMVwQQFcfs8JOqfoA1FqfH_fLPwQ71jK/view).
   After that, execute following commands:

   ```shell
   unzip sample_data_for_artag_awsim.zip
   mv sample_data_for_artag_awsim/rosbag/ ~/driving_log_replayer_data/ar_tag_based_localizer/sample/input_bag
   mv sample_data_for_artag_awsim ~/driving_log_replayer_data/ar_tag_based_localizer/sample/map
   ```

3. Filter and slice bag

The "/clock" topic needs to be deleted.
The default rosbag file is generated by AWSIM, and the timestamp is Start:68.666, End:199.516, which is about 130 seconds.
It is good to cut it off at 126.5 seconds when the third AR tag is shown.

```shell
source ~/autoware/install/setup.bash
cd ~/driving_log_replayer_data/ar_tag_based_localizer/sample
ros2 bag filter input_bag -o filtered_bag -x "/clock"
ros2 bag slice filtered_bag -o sliced_bag -e 126.5
rm -rf input_bag
rm -rf filtered_bag
mv sliced_bag input_bag
```

## How to run

1. Run the simulation

   ```shell
   dlr simulation run -p ar_tag_based_localizer -l play_rate:=0.5
   ```

2. Check the results

   Results are displayed in the terminal like below.

   ```shell
   test case 1 / 1 : use case: sample
   --------------------------------------------------
   TestResult: Passed
   Passed: ArTagBasedLocalizer Availability (Success): Detected 1 AR tags
   ```
